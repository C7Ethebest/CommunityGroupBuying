{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["/**!\n * digest-header - index.js\n *\n * Copyright(c) fengmk2 and other contributors.\n * MIT Licensed\n *\n * Authors:\n *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)\n */\n\n\n\n/**\n * Module dependencies.\n */\n\nvar crypto = require('crypto');\nvar utility = require('utility');\n\nvar AUTH_KEY_VALUE_RE = /(\\w+)=[\"']?([^'\"]+)[\"']?/;\nvar NC = 0;\nvar NC_PAD = '00000000';\n\nfunction digestAuthHeader(method, uri, wwwAuthenticate, userpass) {\n  var parts = wwwAuthenticate.split(',');\n  var opts = {};\n  for (var i = 0; i < parts.length; i++) {\n    var m = parts[i].match(AUTH_KEY_VALUE_RE);\n    if (m) {\n      opts[m[1]] = m[2].replace(/[\"']/g, '');\n    }\n  }\n\n  if (!opts.realm || !opts.nonce) {\n    return '';\n  }\n\n  var qop = opts.qop || '';\n\n  // WWW-Authenticate: Digest realm=\"testrealm@host.com\",\n  //                       qop=\"auth,auth-int\",\n  //                       nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\",\n  //                       opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"\n  // Authorization: Digest username=\"Mufasa\",\n  //                    realm=\"testrealm@host.com\",\n  //                    nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\",\n  //                    uri=\"/dir/index.html\",\n  //                    qop=auth,\n  //                    nc=00000001,\n  //                    cnonce=\"0a4f113b\",\n  //                    response=\"6629fae49393a05397450978507c4ef1\",\n  //                    opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"\n  // HA1 = MD5( \"Mufasa:testrealm@host.com:Circle Of Life\" )\n  //      = 939e7578ed9e3c518a452acee763bce9\n  //\n  //  HA2 = MD5( \"GET:/dir/index.html\" )\n  //      = 39aff3a2bab6126f332b942af96d3366\n  //\n  //  Response = MD5( \"939e7578ed9e3c518a452acee763bce9:\\\n  //                   dcd98b7102dd2f0e8b11d0f600bfb0c093:\\\n  //                   00000001:0a4f113b:auth:\\\n  //                   39aff3a2bab6126f332b942af96d3366\" )\n  //           = 6629fae49393a05397450978507c4ef1\n  userpass = userpass.split(':');\n\n  var nc = String(++NC);\n  nc = NC_PAD.substring(nc.length) + nc;\n  var cnonce = crypto.randomBytes(8).toString('hex');\n\n  var ha1 = utility.md5(userpass[0] + ':' + opts.realm + ':' + userpass[1]);\n  var ha2 = utility.md5(method.toUpperCase() + ':' + uri);\n  var s = ha1 + ':' + opts.nonce;\n  if (qop) {\n    qop = qop.split(',')[0];\n    s += ':' + nc + ':' + cnonce + ':' + qop;\n  }\n  s += ':' + ha2;\n  var response = utility.md5(s);\n  var authstring = 'Digest username=\"' + userpass[0] + '\", realm=\"' + opts.realm\n    + '\", nonce=\"' + opts.nonce + '\", uri=\"' + uri\n    + '\", response=\"' + response + '\"';\n  if (opts.opaque) {\n    authstring += ', opaque=\"' + opts.opaque + '\"';\n  }\n  if (qop) {\n    authstring +=', qop=' + qop + ', nc=' + nc + ', cnonce=\"' + cnonce + '\"';\n  }\n  return authstring;\n}\n\nmodule.exports = digestAuthHeader;\n"]}